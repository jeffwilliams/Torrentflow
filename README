
Copyright: Portions of the ruby libtorrent-rasterbar wrapper code is taken from 
  Joshua Bassett's libtorrent-ruby package, which was under the BSD license.


Backend:
  - libtorrbent-rasterbar
  - Config files, passwd file

Controller: 
  - A ruby daemon that contains the libtorrent session.

Frontend:
  - Apache
  - eRuby
    - Install eruby, mod_ruby
    - In /etc/apache2/apache2.conf add:

    <IfModule mod_ruby.c>
      # for Apache::ERubyRun
      RubyRequire apache/eruby-run

      # handle *.rhtml as eruby files.
      <Files *.rhtml>
        SetHandler ruby-object
        RubyHandler Apache::ERubyRun.instance
      </Files>

      AddType text/html .rhtml
    </IfModule>
  - In /etc/apache2/mods-available/dir.conf, add index.rhtml to the DirectoryIndex varialbe
 
  - RubyAddPath: <http://www.modruby.net/en/doc/?ApacheDirectives>

  - Alternative to eRuby: ERB (embedded ruby)

DEPENDENCIES:
-------------

Running requires:
  ruby (version 1.8)
  apache2
  libapache2-mod-ruby
  eruby
  libjson-ruby
  libtorrent-rasterbar (version 0.13 or 0.14)

Building requires:

  ruby1.8-dev
  libtorrent-rasterbar-dev (version 0.13 or 0.14)

BUILDING:
---------

1. Change to the mylibtorrent directory and run ./extconf.rb

INSTALLATION:
-------------

1. Copy the ruby-torrent directory to the desired installation path. After this step,
   later steps will use RUBY_TORRENT_HOME to refer to this path (the path includes the 
  ruby-torrent/ part).

2. Add the following stanza to /etc/apache2/apache2.conf:

    <IfModule mod_ruby.c>
      # for Apache::ERubyRun
      RubyRequire apache/eruby-run
 
      RubyAddPath RUBY_TORRENT_HOME/daemon
      RubyAddPath RUBY_TORRENT_HOME/www-lib
   
      # handle *.rhtml as eruby files.
      <Files *.rhtml>
        SetHandler ruby-object
        RubyHandler Apache::ERubyRun.instance
      </Files>
      
      AddType text/html .rhtml
    </IfModule>

  But replace RUBY_TORRENT_HOME with the real home. 

3. In /etc/apache2/mods-available/dir.conf, add index.rhtml to the DirectoryIndex variable

4. Make a symbolic link from the web-accessible directory under the apache root where 
   you would like rubytorrent to be accessible to the www directory of rubytorrent. 

   For example, if apache home is /var/www/ and you want to be able to access rubytorrent
   as http://host/rubytorrent, then:

      cd /var/www/
      ln -s RUBY_TORRENT_HOME/www rubytorrent

RUNNING
-------

1. Change to the directory RUBY_TORRENT_HOME/daemon and add some user accounts ./adduser.rb
  
    ./adduser <username> <password>

   If you add more users later, you must restart the daemon for it to detect the changes.

2. Change to the directory RUBY_TORRENT_HOME/daemon and start daemon.rb:

    ./daemon.rb

   and let it run in the background. For debugging, pass the -x option to prevent it 
   from daemonizing.


3. Browse to the rubytorrent webpage and login.


TODO
----

- Make pause actually pause torrents (make them not automanaged when paused)

- Allow deletion of users from password file

- Allow use of different ports. Currently 3000 is encoded in the Apache side - how to config www pages
  - Could use an env var: RubySetEnv LANG "ja_JP.eucJP"
  - See http://www.modruby.net/en/index.rbx?mode=search&word=shugo#label-15

- Use fast-resume data for torrents
